# AdFlowHQ Project Guide for OpenAI Codex

This AGENTS.md file provides comprehensive guidance for OpenAI Codex when working with the AdFlowHQ codebase to implement authentication, HTTPS enforcement, and page reordering.

## Project Structure for OpenAI Codex Navigation

- `/ui`: React TypeScript frontend that OpenAI Codex should enhance
  - `/src/components`: React components for authentication UI
  - `/src/pages`: Application pages including new auth pages
  - `/src/contexts`: React contexts for authentication state
  - `/src/hooks`: Custom hooks for auth and API calls
  - `/public`: Static assets (OpenAI Codex should not modify these directly)
- `/auth`: New authentication service that OpenAI Codex should create
- `/server`: HTTP server with authentication middleware
- `/migrations`: Database schema files for user management
- `/config`: Configuration files for OAuth and security
- `/docker-compose.yml`: Infrastructure setup with HTTPS
- `/temporal-config`: Temporal workflow configuration
- `/tests`: Test files that OpenAI Codex should maintain and extend

## Primary Implementation Tasks for OpenAI Codex

### 1. Authentication System Implementation
OpenAI Codex should create a comprehensive authentication system with:

- **Multi-provider OAuth**: Google, Facebook, Apple integration
- **Email/password authentication**: Traditional registration and login
- **JWT token management**: Access and refresh token handling
- **Protected routes**: Frontend and backend route protection
- **User profile management**: CRUD operations for user data

### 2. HTTPS Security Enforcement
OpenAI Codex must implement enterprise-grade security:

- **Traefik reverse proxy**: Automatic SSL certificate management
- **Let's Encrypt integration**: Certificate auto-renewal
- **Security headers**: CSP, HSTS, XSS protection implementation
- **HTTP to HTTPS redirects**: Force secure connections

### 3. Page Reordering & UX Enhancement
OpenAI Codex should restructure the application flow:

- **Authentication-first routing**: Login/Register as entry points
- **Protected dashboard access**: Require authentication for main features
- **Enhanced navigation**: User context with profile and logout
- **Responsive design**: Mobile-friendly authentication pages

## Coding Conventions for OpenAI Codex

### General Conventions for AGENTS.md Implementation

- Use **TypeScript** for all frontend code generated by OpenAI Codex
- Use **Go** for backend authentication services
- OpenAI Codex should follow existing code style in each file
- AGENTS.md requires meaningful variable and function names in OpenAI Codex output
- OpenAI Codex should add comprehensive comments for security-critical code

### React Components Guidelines for OpenAI Codex

- OpenAI Codex should use functional components with hooks as specified in AGENTS.md
- Implement proper error boundaries for authentication flows
- AGENTS.md requires proper TypeScript interfaces for all props and state
- OpenAI Codex must follow the file naming convention: PascalCase.tsx
- Use React Query for API state management in authentication flows

### Go Backend Standards for OpenAI Codex

- OpenAI Codex should implement proper error handling and logging
- Use structured logging for authentication events
- AGENTS.md requires prepared statements for all database operations
- Implement rate limiting for authentication endpoints
- OpenAI Codex must validate all input data and sanitize outputs

### Security Requirements for OpenAI Codex

- **JWT Security**: Strong secrets, proper token expiration, refresh token rotation
- **OAuth Security**: State parameter validation, secure callback URLs
- **Database Security**: Prepared statements, input validation, password hashing
- **HTTPS Enforcement**: Secure cookies, HSTS headers, certificate management

## Testing Requirements for OpenAI Codex

OpenAI Codex should run tests with the following commands:

```bash
# Frontend tests
cd ui
npm test

# Backend tests
go test ./...

# Integration tests
go test -tags=integration ./tests/...

# Security tests
go test -tags=security ./auth/...

# Run all tests with coverage
npm test -- --coverage
go test -coverprofile=coverage.out ./...
```

### Test Coverage Requirements for OpenAI Codex

- **Authentication flows**: 90%+ coverage for login, register, OAuth
- **Security middleware**: 100% coverage for JWT validation, rate limiting
- **Frontend components**: 80%+ coverage for auth pages and protected routes
- **API endpoints**: 90%+ coverage for all authentication endpoints

## Database Migration Guidelines for OpenAI Codex

OpenAI Codex should create and run migrations:

```bash
# Create new migration
migrate create -ext sql -dir migrations -seq create_users_table

# Run migrations
migrate -path migrations -database "postgres://user:pass@localhost/dbname?sslmode=disable" up

# Rollback if needed
migrate -path migrations -database "postgres://user:pass@localhost/dbname?sslmode=disable" down 1
```

## Docker & Infrastructure for OpenAI Codex

OpenAI Codex should update Docker configuration:

```bash
# Build and start all services
docker-compose up --build

# Start with Traefik for HTTPS
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up

# Check certificate generation
docker-compose logs traefik

# Restart auth service only
docker-compose restart auth-server
```

## Environment Configuration for OpenAI Codex

OpenAI Codex must create and configure environment variables:

```bash
# Required OAuth credentials
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
FACEBOOK_APP_ID=your-facebook-app-id
FACEBOOK_APP_SECRET=your-facebook-app-secret

# JWT configuration
JWT_SECRET=your-super-secret-jwt-key-minimum-32-characters

# Database connection
DATABASE_URL=postgres://temporal:temporal@postgresql:5432/temporal

# SSL/Domain configuration
DOMAIN=your-domain.com
EMAIL=admin@your-domain.com
```

## API Endpoints for OpenAI Codex Implementation

OpenAI Codex should implement these authentication endpoints:

```bash
# Authentication endpoints
POST /api/auth/register          # User registration
POST /api/auth/login             # Email/password login
GET  /api/auth/google            # Google OAuth initiation
GET  /api/auth/facebook          # Facebook OAuth initiation
GET  /api/auth/apple             # Apple OAuth initiation
POST /api/auth/refresh           # Token refresh
POST /api/auth/logout            # User logout

# Protected user endpoints
GET  /api/user/profile           # Get user profile
PUT  /api/user/profile           # Update user profile
DELETE /api/user/account         # Delete user account
```

## Pull Request Guidelines for OpenAI Codex

When OpenAI Codex creates a PR for authentication features, ensure it:

1. **Security Review**: Includes security checklist and threat assessment
2. **Test Coverage**: All authentication flows have comprehensive tests
3. **Documentation**: Updates API documentation and deployment guides
4. **Environment Setup**: Includes environment variable documentation
5. **Migration Scripts**: Database migrations with rollback procedures
6. **Performance**: Load testing results for authentication endpoints
7. **Compliance**: GDPR/privacy compliance for user data handling

## Programmatic Checks for OpenAI Codex

Before submitting authentication changes, OpenAI Codex must run:

```bash
# Frontend checks
cd ui
npm run lint                     # ESLint validation
npm run type-check              # TypeScript compilation
npm run build                   # Production build test
npm run test:auth               # Authentication-specific tests

# Backend checks
go fmt ./...                    # Code formatting
go vet ./...                    # Static analysis
golint ./...                    # Linting
go test -race ./...             # Race condition detection
go test -bench=. ./auth/...     # Performance benchmarks

# Security checks
gosec ./...                     # Security vulnerability scan
npm audit                       # Frontend dependency audit
docker scout cves              # Container vulnerability scan
```

## Performance Requirements for OpenAI Codex

- **Authentication latency**: < 200ms for login/register
- **OAuth redirects**: < 500ms for provider callbacks
- **JWT validation**: < 50ms for token verification
- **Database queries**: < 100ms for user lookups
- **HTTPS handshake**: < 1000ms for SSL connection

## Monitoring & Logging for OpenAI Codex

OpenAI Codex should implement comprehensive logging:

```go
// Structured logging for authentication events
log.Info("User login attempt", 
    "email", user.Email,
    "provider", "email",
    "ip", clientIP,
    "timestamp", time.Now())

// Security event logging
log.Warn("Failed login attempt",
    "email", loginRequest.Email,
    "ip", clientIP,
    "attempts", attemptCount)
```

## Success Criteria for OpenAI Codex Implementation

✅ **Authentication**: Users can register/login with email and OAuth providers
✅ **Security**: All traffic encrypted with valid SSL certificates  
✅ **UX**: Seamless navigation with protected routes and user context
✅ **Performance**: Sub-200ms authentication response times
✅ **Testing**: 90%+ test coverage for authentication flows
✅ **Monitoring**: Comprehensive logging and error tracking
✅ **Compliance**: GDPR-compliant user data handling

All checks must pass before OpenAI Codex generated code can be merged. AGENTS.md ensures OpenAI Codex follows these enterprise-grade security requirements. 